<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Teste – Assincronias Ventilatórias</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  body { font-family: Arial, sans-serif; padding: 20px; background:#fff; color:#111827; }
  h1 { font-size: 22px; margin: 0 0 6px; }
  p { color:#4b5563; margin: 0 0 16px; line-height:1.4; }

  .card { border:1px solid #e5e7eb; border-radius:10px; padding:14px; margin-bottom:14px; background:#f9fafb; }
  label { font-weight:700; display:block; }
  .legend { font-size:13px; color:#374151; margin-top:6px; line-height:1.4; }

  .controls { margin-top:10px; padding-top:10px; border-top:1px dashed #d1d5db; display:none; }
  select { margin-top:6px; font-size:14px; }

  .radio-line { display:flex; gap:14px; flex-wrap:wrap; margin-top:8px; }
  .radio-line label { font-weight:400; color:#111827; }

  button { padding:10px 14px; font-size:16px; margin-top:8px; cursor:pointer; }

  .resultado { margin-top:20px; font-weight:700; }
  .detalhes { margin-top:12px; font-weight:400; }
  ul { margin-left:18px; }

  .pill { display:inline-block; font-size:12px; padding:3px 8px; border:1px solid #e5e7eb; border-radius:999px; background:#fff; color:#4b5563; margin-left:8px; }
  .kicker { font-size:12px; color:#6b7280; margin-top:6px; }

  footer { margin-top:40px; padding-top:16px; border-top:1px solid #e5e7eb; font-size:12px; color:#4b5563; line-height:1.5; }
</style>
</head>

<body>

<h1>Teste clínico – Assincronias Ventilatórias</h1>
<p>
  1) Selecione o <b>tipo de ciclo</b>. 2) Marque os achados e, quando aplicável, indique “onde”.
  O motor descreve o <b>sinal no traçado</b>, sugere <b>padrões/assincronias prováveis</b>, lista <b>hipóteses</b> e traz um <b>resumo de ajustes possíveis</b> (educacional).
</p>

<!-- CONTEXTO DO CICLO -->
<div class="card">
  <label>Tipo de ciclo observado <span class="pill">Obrigatório</span></label>
  <div class="legend">
    Ajuda a interpretar o traçado: se o ciclo foi iniciado pelo ventilador (mandatório) ou pelo paciente (assistido), ou se há mistura.
  </div>
  <div class="radio-line">
    <label><input type="radio" name="tipoCiclo" value="mandatorio" /> Mandatório (a tempo)</label>
    <label><input type="radio" name="tipoCiclo" value="assistido" /> Assistido (disparado pelo paciente)</label>
    <label><input type="radio" name="tipoCiclo" value="misto" /> Misto (mandatórios + assistidos)</label>
    <label><input type="radio" name="tipoCiclo" value="nao_sei" /> Não sei</label>
  </div>
</div>

<!-- BLOCO ESPECÍFICO: DISPARO REVERSO -->
<div class="card">
  <label><input type="checkbox" id="rt_habilitar"> Avaliar Disparo Reverso (Reverse Triggering) <span class="pill">Padrão</span></label>
  <div class="legend">
    Use quando suspeitar que um ciclo <b>mandatório</b> esteja “puxando” um <b>segundo esforço inspiratório</b> do paciente dentro do mesmo ciclo.
    Pode ocorrer <b>com</b> ou <b>sem</b> ciclo duplo.
  </div>

  <div class="controls" id="ctl_rt">
    <div class="legend">
      <b>Marque os critérios:</b> quanto mais itens positivos, maior a confiança.
    </div>

    <!-- Critério 1: Segundo esforço (separado por curva para ficar claro) -->
    <label style="margin-top:10px; font-weight:700;">
      <input type="checkbox" id="rt_segundoEsforco_pressao">
      Pressão: entalhe/queda durante a inspiração (no meio/fim)
    </label>
    <div class="legend">
      Deformação inspiratória na pressão (ex.: “entalhe” no platô / formato em M), sem necessariamente gerar novo ciclo.
    </div>

    <label style="margin-top:10px; font-weight:700;">
      <input type="checkbox" id="rt_segundoEsforco_fluxo">
      Fluxo: o fluxo inspiratório “volta a subir” no meio/fim da inspiração
    </label>
    <div class="legend">
      Uma segunda elevação do fluxo inspiratório dentro do mesmo ciclo, sugerindo “segundo esforço” do paciente.
    </div>

    <!-- Critério 2: Acoplamento/repetição -->
    <label style="margin-top:10px; font-weight:700;">
      <input type="checkbox" id="rt_acoplamento">
      Ocorre de forma repetitiva e “colada” aos ciclos mandatórios
    </label>
    <div class="legend">
      Ex.: aparece em vários ciclos seguidos, com atraso semelhante após o início do ciclo.
    </div>

    <div style="margin-top:10px;">
      Padrão de acoplamento:
      <select id="rt_padrao">
        <option value="incerto">Incerto</option>
        <option value="1:1">1:1 (quase todo ciclo mandatório)</option>
        <option value="1:2">1:2 (a cada 2 ciclos)</option>
        <option value="1:3">1:3 (a cada 3 ciclos)</option>
      </select>
    </div>

    <!-- Critério 3: Fenótipo com/sem ciclo duplo -->
    <label style="margin-top:10px; font-weight:700;">
      <input type="checkbox" id="rt_cicloDuplo">
      Há ciclo duplo (double triggering)
    </label>
    <div class="legend">
      Use apenas para classificar o fenótipo. Disparo reverso pode existir mesmo sem ciclo duplo.
    </div>

    <!-- Critério 4 (opcional): reforço visual -->
    <label style="margin-top:10px; font-weight:700;">
      <input type="checkbox" id="rt_emMandatorios">
      Vejo isso principalmente em ciclos mandatórios (a tempo)
    </label>
    <div class="legend">
      Ajuda quando o traçado é misto e você consegue identificar que o padrão está nos mandatórios.
    </div>
  </div>
</div>

<!-- Degrau expiratório -->
<div class="card">
  <label><input type="checkbox" id="degrauExp"> Degrau expiratório <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> “degrau”/entalhe no <b>ramo expiratório</b> (a queda do fluxo não é suave).
    <br><b>Importante:</b> é um achado inespecífico; sozinho <b>não</b> confirma disparo reverso.
  </div>
  <div class="controls" id="ctl_degrauExp">
    Em que parte da expiração?
    <select id="degrauExp_local">
      <option value="início">Início</option>
      <option value="meio">Meio</option>
      <option value="final">Final</option>
    </select>
  </div>
</div>

<!-- Pico inspiratório abaulado -->
<div class="card">
  <label><input type="checkbox" id="picoAbaulado"> Pico inspiratório abaulado <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> pico inspiratório “arredondado” (sem ponta). Pode ocorrer quando o fluxo ofertado não acompanha a demanda ou quando há maior resistência.
  </div>
</div>

<!-- Abaulamento do fluxo inspiratório -->
<div class="card">
  <label><input type="checkbox" id="abaulamentoPlatoFluxo"> Abaulamento do fluxo durante a inspiração <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> o fluxo inspiratório “volta a subir” ou faz uma “barriga” no meio/fim da inspiração.
  </div>
  <div class="controls" id="ctl_abaulamentoPlatoFluxo">
    Onde ocorre mais?
    <select id="abaulamentoPlato_local">
      <option value="no início">No início</option>
      <option value="no meio">No meio</option>
      <option value="no final">No final</option>
    </select>
  </div>
</div>

<!-- Ciclagem precoce -->
<div class="card">
  <label><input type="checkbox" id="ciclagemPrecoce"> Ciclagem precoce <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> a inspiração termina com <b>fluxo inspiratório ainda positivo</b> (não chega perto de zero).
  </div>
</div>

<!-- Ciclagem tardia -->
<div class="card">
  <label><input type="checkbox" id="ciclagemTardia"> Ciclagem tardia <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> o ventilador mantém a inspiração apesar de o fluxo já estar <b>~zero</b>.
  </div>
</div>

<!-- Letra M -->
<div class="card">
  <label><input type="checkbox" id="letraM"> Entalhe no platô de pressão (“Letra M”) <span class="pill">Pressão</span></label>
  <div class="legend">
    <b>Sinal:</b> queda/entalhe no platô inspiratório com retorno, formando “M”.
    <br><b>Não</b> é “dois picos” e <b>não</b> é ciclo duplo.
  </div>
</div>

<!-- Concavidade no fluxo -->
<div class="card">
  <label><input type="checkbox" id="concavidade"> Concavidade no fluxo <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> a curva “afunda” (concava) onde se esperaria uma trajetória mais uniforme.
  </div>
  <div class="controls" id="ctl_concavidade">
    Onde aparece?
    <select id="concavidade_fase">
      <option value="inspiração">Inspiração</option>
      <option value="expiração">Expiração</option>
    </select>
    <select id="concavidade_local">
      <option value="no início">Início</option>
      <option value="no meio">Meio</option>
      <option value="no final">Final</option>
    </select>
  </div>
</div>

<!-- Convexidade no fluxo -->
<div class="card">
  <label><input type="checkbox" id="convexidade"> Convexidade no fluxo <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> a curva “abaula para fora” (convexa).
  </div>
  <div class="controls" id="ctl_convexidade">
    Onde aparece?
    <select id="convexidade_fase">
      <option value="inspiração">Inspiração</option>
      <option value="expiração">Expiração</option>
    </select>
    <select id="convexidade_local">
      <option value="no início">Início</option>
      <option value="no meio">Meio</option>
      <option value="no final">Final</option>
    </select>
  </div>
</div>

<!-- Fluxo expiratório tremido -->
<div class="card">
  <label><input type="checkbox" id="fluxoTremidoExp"> Fluxo expiratório “tremido” (serrilhado) <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> pequenas oscilações repetidas no ramo expiratório.
    <br><b>Mais comum em:</b> secreções/condensado/interferência no tubo/circuito (correlacionar com ausculta e aspiração).
  </div>
</div>

<!-- Sinal de raiz quadrada -->
<div class="card">
  <label><input type="checkbox" id="raizQuadrada"> Padrão “raiz quadrada” (limitação de fluxo / resistência) <span class="pill">Mecânica</span></label>
  <div class="legend">
    <b>Sinal:</b> traçado “achatado/quadrado”, compatível com <b>limitação ao fluxo</b>.
    <br><b>Interpretação típica:</b> aumento de resistência (ex.: broncoespasmo/obstrução), dependendo do contexto.
  </div>
</div>

<!-- Spike (pressão) - saída -->
<div class="card">
  <label><input type="checkbox" id="spikeSaida"> Spike na saída (fim da inspiração) <span class="pill">Pressão</span></label>
  <div class="legend">
    <b>Sinal:</b> espícula curta no fim da inspiração, na transição para expiração.
  </div>
</div>

<!-- Overshoot (pressão) - entrada ou saída -->
<div class="card">
  <label><input type="checkbox" id="overshoot"> Overshoot de pressão <span class="pill">Pressão</span></label>
  <div class="legend">
    <b>Sinal:</b> a pressão “passa do alvo” e retorna. Pode ser no <b>início</b> (entrada) ou no <b>fim</b> (saída) do ciclo.
  </div>
  <div class="controls" id="ctl_overshoot">
    Onde ocorre?
    <div class="radio-line">
      <label><input type="radio" name="ov_tipo" value="entrada" checked /> Entrada (início / subida)</label>
      <label><input type="radio" name="ov_tipo" value="saida" /> Saída (fim / troca de fase)</label>
    </div>
  </div>
</div>

<!-- Degrau recorrente pós-aspiração -->
<div class="card">
  <label><input type="checkbox" id="degrauRecorrente"> Degrau recorrente após aspiração <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> degraus repetidos mesmo após aspiração, sugerindo fator persistente (secreção/obstrução/patência).
  </div>
</div>

<button id="btnRodar">Rodar análise</button>

<div class="resultado" id="resultado"></div>

<!-- RESUMO EXECUTIVO -->
<div class="card" id="resumoExecutivo" style="display:none;">
  <label>Resumo executivo</label>
  <div class="legend">
    Linguagem simples (mas técnica): o que apareceu no traçado, qual padrão/assincronia é mais provável e o que normalmente se ajusta.
  </div>

  <div class="detalhes">
    <p><b>1) Sinais no traçado:</b></p>
    <ul id="listaSinais"></ul>

    <p style="margin-top:10px;"><b>2) Padrão/assincronia provável:</b></p>
    <ul id="listaAssincronias"></ul>

    <p style="margin-top:10px;"><b>3) Ajustes geralmente considerados (resumo):</b></p>
    <ul id="listaCorrecoes"></ul>

    <p style="margin-top:10px;"><b>4) Hipóteses:</b></p>
    <ul id="listaHipoteses"></ul>

    <p class="kicker" id="notaContextoResumo"></p>
  </div>
</div>

<div class="detalhes" id="detalhes"></div>

<!-- PROPOSTAS DE MELHORIA -->
<div class="card" id="propostasMelhoria">
  <label>Propostas de melhoria do motor</label>
  <div class="legend">
    O objetivo é deixar o resultado mais confiável e mais “guiado”, sem perder rigor técnico.
  </div>
  <div class="detalhes">
    <ul>
      <li><b>Selecionar modo ventilatório (VCV/PCV/PSV/PRVC)</b>: o motor só sugere ajustes que fazem sentido para o modo (ex.: % ciclagem em PSV).</li>
      <li><b>Parâmetros opcionais mínimos</b> (Ti, rise/pressurização, trigger, % ciclagem, FR/VT, PEEP): melhora a precisão do “como ajustar”.</li>
      <li><b>Checagem entre curvas</b>: antes de “batizar” a assincronia, pedir confirmação em pressão/fluxo (reduz falso positivo).</li>
      <li><b>Confiança do resultado (baixa/média/alta)</b>: baseada em critérios objetivos (ex.: para disparo reverso, exigir “segundo esforço” + repetição + contexto mandatório).</li>
      <li><b>Separar “sinal → padrão → hipótese → ajuste”</b>: o usuário entende por que o motor concluiu aquilo.</li>
      <li><b>Botão de copiar o resumo</b>: útil para discussão de caso/aula/checklist.</li>
      <li><b>Exemplos visuais por item</b>: miniaturas ao marcar cada achado, acelerando o reconhecimento do sinal.</li>
      <li><b>Versão do motor</b>: exibir versão e histórico curto de mudanças para rastreabilidade educacional.</li>
    </ul>
  </div>
</div>

<script>
  // ===== Utilitários DOM (evita falhas de "globais" em navegadores/strict) =====
  const $ = (id) => document.getElementById(id);

  function getTipoCiclo() {
    const el = document.querySelector('input[name="tipoCiclo"]:checked');
    return el ? el.value : null;
  }

  function valRadio(name){
    const el = document.querySelector(input[name="${name}"]:checked);
    return el ? el.value : null;
  }

  function labelTipoCiclo(v){
    if (v === "mandatorio") return "Mandatório (a tempo)";
    if (v === "assistido") return "Assistido (disparado pelo paciente)";
    if (v === "misto") return "Misto (mandatórios + assistidos)";
    if (v === "nao_sei") return "Não informado / não sei";
    return "Não selecionado";
  }

  function unique(arr) {
    const seen = new Set();
    const out = [];
    arr.forEach(x => {
      const k = String(x).trim();
      if (!k) return;
      if (!seen.has(k)) { seen.add(k); out.push(k); }
    });
    return out;
  }

  function mapToArray(map) {
    const out = [];
    for (const [k, v] of map.entries()) out.push(v ? ${k} — ${v} : k);
    return out;
  }

  // ===== Mostrar/ocultar controles =====
  const toggles = [
    ["degrauExp", "ctl_degrauExp"],
    ["concavidade", "ctl_concavidade"],
    ["convexidade", "ctl_convexidade"],
    ["overshoot", "ctl_overshoot"],
    ["abaulamentoPlatoFluxo", "ctl_abaulamentoPlatoFluxo"],
    ["rt_habilitar", "ctl_rt"]
  ];

  toggles.forEach(([cbId, ctlId]) => {
    const cb = $(cbId);
    const ctl = $(ctlId);
    cb.addEventListener("change", () => {
      ctl.style.display = cb.checked ? "block" : "none";
    });
  });

  // ===== Função principal =====
  function rodarAnalise() {
    const tipoCiclo = getTipoCiclo();

    const resultadoEl = $("resultado");
    const detalhesEl = $("detalhes");
    const resumoBox = $("resumoExecutivo");

    const listaSinais = $("listaSinais");
    const listaAssincronias = $("listaAssincronias");
    const listaCorrecoes = $("listaCorrecoes");
    const listaHipoteses = $("listaHipoteses");
    const notaCtx = $("notaContextoResumo");

    if (!tipoCiclo) {
      resultadoEl.innerHTML = "Selecione o tipo de ciclo (mandatório, assistido, misto ou não sei) antes de rodar a análise.";
      detalhesEl.innerHTML = "";
      resumoBox.style.display = "none";
      return;
    }

    const conservador = (tipoCiclo === "nao_sei");
    const misto = (tipoCiclo === "misto");

    function notaResumo() {
      if (conservador) return "Nota: como o tipo de ciclo não foi definido, as sugestões ficam mais gerais e devem ser confirmadas no contexto do modo ventilatório.";
      if (misto) return "Nota: em traçado misto, confirme ciclo a ciclo (mandatório vs assistido) antes de concluir.";
      return "";
    }

    function notaContexto(extra) {
      if (conservador) return "Interpretação mais conservadora (tipo de ciclo não informado). " + extra;
      if (misto) return "Ciclos mistos podem mostrar padrões diferentes em ciclos diferentes. " + extra;
      return extra;
    }

    const achados = [];
    const sinais = [];
    const hipoteses = [];
    const assincroniaMap = new Map();
    const correcaoMap = new Map();

    function addAssincronia(nome, justificativa, correcao) {
      if (!assincroniaMap.has(nome)) assincroniaMap.set(nome, justificativa || "");
      if (!correcaoMap.has(nome)) correcaoMap.set(nome, correcao || "");
    }

    // ===================== DISPARO REVERSO =====================
    if ($("rt_habilitar").checked) {
      const sPressao = $("rt_segundoEsforco_pressao").checked;
      const sFluxo   = $("rt_segundoEsforco_fluxo").checked;
      const acopl    = $("rt_acoplamento").checked;
      const padrao   = $("rt_padrao").value;
      const duplo    = $("rt_cicloDuplo").checked;
      const emMand   = $("rt_emMandatorios").checked;

      const contextoOk = (tipoCiclo === "mandatorio" || tipoCiclo === "misto" || tipoCiclo === "nao_sei");
      const reforcoMandatorio = (tipoCiclo === "mandatorio") || emMand;

      let score = 0;
      if (reforcoMandatorio) score++;
      if (sPressao || sFluxo) score++;
      if (acopl) score++;
      if (padrao !== "incerto") score++;

      if (sPressao) sinais.push("Disparo reverso: entalhe/queda na pressão durante a inspiração (meio/fim).");
      if (sFluxo)   sinais.push("Disparo reverso: segunda elevação do fluxo inspiratório no meio/fim.");
      if (acopl)    sinais.push(Disparo reverso: padrão repetitivo acoplado (${padrao}).);
      if (duplo)    sinais.push("Disparo reverso: há ciclo duplo associado (fenótipo com double triggering).");

      const criteriosMinimos = reforcoMandatorio && (sPressao || sFluxo) && acopl;

      if (contextoOk && criteriosMinimos) {
        const confianca =
          (score >= 4) ? "alta" :
          (score === 3) ? "moderada" : "baixa";

        if (!duplo) {
          addAssincronia(
            "Disparo reverso (reverse triggering) — sem ciclo duplo",
            Critérios: ciclo mandatório (ou em mandatórios) + “segundo esforço” + repetição. Confiança ${confianca}.,
            "Rever entrainment: considerar ajustes em FR/Ti dos mandatórios quando apropriado, reavaliar conforto/drive (sedação/analgesia conforme objetivos) e confirmar padrão em pressão e fluxo ciclo a ciclo."
          );
        } else {
          addAssincronia(
            "Disparo reverso (reverse triggering) — com ciclo duplo",
            Critérios: ciclo mandatório (ou em mandatórios) + “segundo esforço” + repetição. Confiança ${confianca}.,
            "Além de avaliar entrainment (FR/Ti e drive), revisar ajustes que favorecem ciclo duplo (término/ciclagem conforme modo) e confirmar em pressão/fluxo."
          );
        }

        hipoteses.push("Padrão compatível com entrainment: o ciclo mandatório pode induzir um esforço neural secundário dentro do mesmo ciclo.");
        achados.push("Disparo reverso → padrão de “segundo esforço” repetitivo acoplado aos mandatórios (com ou sem ciclo duplo).");
      } else {
        addAssincronia(
          "Suspeita de disparo reverso (critérios incompletos)",
          "Para concluir com mais segurança: marque (1) ‘segundo esforço’ (pressão e/ou fluxo) e (2) repetição/acoplamento, preferencialmente em ciclos mandatórios.",
          "Completar critérios do bloco de disparo reverso e confirmar se o padrão se repete em vários ciclos mandatórios."
        );
        achados.push("Disparo reverso (suspeita) → faltam critérios para concluir.");
      }
    }

    // ===================== ACHADOS INDIVIDUAIS =====================
    if ($("degrauExp").checked) {
      const local = $("degrauExp_local").value;
      sinais.push(Degrau/entalhe no ramo expiratório (${local}).);
      addAssincronia(
        "Alteração de expiração / possível auto-PEEP (contextual)",
        "Degrau no ramo expiratório (sinal inespecífico).",
        "Em geral, considerar otimizar tempo expiratório (Ti/FR/VT conforme modo e protocolo), avaliar broncoobstrução e secreções, e discutir PEEP externa se houver evidência de auto-PEEP."
      );
      hipoteses.push("Esvaziamento expiratório comprometido (auto-PEEP/dinâmica expiratória desfavorável/esforço expiratório ativo).");
      achados.push(Degrau expiratório (fluxo) → entalhe no ramo expiratório (${local}). ${notaContexto("Sinal inespecífico.")});
    }

    if ($("picoAbaulado").checked) {
      sinais.push("Pico inspiratório arredondado/abaulado no fluxo.");
      addAssincronia(
        "Fluxo insuficiente / demanda maior que oferta (contextual)",
        "Pico inspiratório sem “ponta”, arredondado.",
        "Geralmente considerar: aumentar oferta de fluxo (VCV) ou ajustar pressurização/rise time (modos a pressão) e checar resistência/obstrução."
      );
      hipoteses.push("Demanda inspiratória pode exceder o fluxo ofertado; considerar também aumento de resistência/obstrução.");
      achados.push(Pico inspiratório abaulado → pico inspiratório arredondado. ${notaContexto("Compatível com demanda > oferta e/ou resistência aumentada, conforme modo.")});
    }

    if ($("abaulamentoPlatoFluxo").checked) {
      const local = $("abaulamentoPlato_local").value;
      sinais.push(Fluxo inspiratório “volta a subir” (${local}).);
      addAssincronia(
        "Fome de fluxo ao longo da inspiração (contextual)",
        "Fluxo volta a subir no meio/fim da inspiração.",
        "Geralmente considerar: ajustar fluxo (VCV) ou pressurização/rise time (PCV/PSV) para acompanhar a demanda e correlacionar com esforço do paciente."
      );
      hipoteses.push("Demanda inspiratória variável durante a inspiração; pode ser fome de fluxo em parte do ciclo.");
      achados.push(Abaulamento do fluxo inspiratório → re-elevação do fluxo (${local}). ${notaContexto("Se repetitivo em mandatórios e associado a ‘segundo esforço’, pode reforçar disparo reverso.")});
    }

    if ($("ciclagemPrecoce").checked) {
      sinais.push("Término inspiratório com fluxo ainda positivo.");
      addAssincronia(
        "Ciclagem precoce",
        "Inspiração termina antes de o fluxo cair próximo de zero.",
        "Geralmente considerar: prolongar Ti ou reduzir sensibilidade de ciclagem (ex.: reduzir % de ciclagem em PSV), conforme modo/protocolo."
      );
      hipoteses.push("Término inspiratório antes da demanda do paciente.");
      achados.push(Ciclagem precoce → termina com fluxo inspiratório ainda positivo. ${notaContexto("Sugere término precoce da inspiração.")});
    }

    if ($("ciclagemTardia").checked) {
      sinais.push("Inspiração mantida apesar de fluxo ~zero.");
      addAssincronia(
        "Ciclagem tardia",
        "Inspiração persiste mesmo quando o fluxo já está ~zero.",
        "Geralmente considerar: reduzir Ti ou aumentar sensibilidade de ciclagem (ex.: aumentar % de ciclagem em PSV), conforme modo/protocolo."
      );
      hipoteses.push("Inspiração prolongada além do necessário; pode gerar desconforto e esforço expiratório ativo.");
      achados.push(Ciclagem tardia → inspiração prolongada após fluxo ~zero. ${notaContexto("Sugere manutenção excessiva da inspiração.")});
    }

    if ($("letraM").checked) {
      sinais.push("Entalhe no platô inspiratório da pressão com formato em “M”.");
      addAssincronia(
        "Interferência de esforço durante a inspiração (Letra M)",
        "Entalhe no platô de pressão durante a inspiração.",
        "Geralmente considerar: revisar sincronização (trigger, pressurização/rise, término/ciclagem) e conforto/drive. Se repetitivo em mandatórios, investigar disparo reverso."
      );
      hipoteses.push("Esforço/demanda do paciente durante a inspiração; em mandatórios repetidos pode ser ‘segundo esforço’ do disparo reverso.");
      achados.push(Letra M (pressão) → entalhe no platô inspiratório. ${notaContexto("Não é ciclo duplo. Se repetitivo em mandatórios, pode reforçar disparo reverso.")});
    }

    if ($("concavidade").checked) {
      const fase = $("concavidade_fase").value;
      const local = $("concavidade_local").value;
      sinais.push(Concavidade no fluxo na ${fase} (${local}).);
      addAssincronia(
        "Demanda/esforço modulando o fluxo (contextual)",
        Concavidade na ${fase} (${local}).,
        "Geralmente considerar: correlacionar com modo e conforto; revisar oferta de assistência (trigger, pressurização/fluxo, ciclagem) se houver desconforto/assincronia."
      );
      hipoteses.push("Modulação do fluxo por esforço/demanda; interpretar junto com pressão/volume e modo.");
      achados.push(Concavidade no fluxo → concavidade na ${fase} (${local}). ${notaContexto("Sugere modulação por esforço/demanda; não define mecanismo isoladamente.")});
    }

    if ($("convexidade").checked) {
      const fase = $("convexidade_fase").value;
      const local = $("convexidade_local").value;
      sinais.push(Convexidade no fluxo na ${fase} (${local}).);
      addAssincronia(
        "Padrão mais imposto / possível sobreassistência (contextual)",
        Convexidade na ${fase} (${local}).,
        "Geralmente considerar: reavaliar nível de assistência e sincronização; evitar sobreassistência conforme metas ventilatórias e avaliação do drive."
      );
      hipoteses.push("Padrão mais imposto/assistido; pode ocorrer em sobreassistência dependendo do modo/contexto.");
      achados.push(Convexidade no fluxo → convexidade na ${fase} (${local}). ${notaContexto("Interpretar com modo e contexto.")});
    }

    if ($("fluxoTremidoExp").checked) {
      sinais.push("Fluxo expiratório serrilhado/oscilações repetidas.");
      addAssincronia(
        "Sinal compatível com secreção/condensado (não é assincronia clássica)",
        "Fluxo expiratório serrilhado.",
        "Geralmente considerar: checar secreções e condensado no circuito; revisar patência do tubo/circuito; considerar aspiração/higiene brônquica conforme avaliação clínica."
      );
      hipoteses.push("Secreções/condensado/interferência no sistema.");
      achados.push(Fluxo expiratório serrilhado → oscilações repetidas na expiração. ${notaContexto("Mais comum com secreção/condensado; correlacionar com clínica.")});
    }

    if ($("raizQuadrada").checked) {
      sinais.push("Padrão compatível com limitação ao fluxo (raiz quadrada).");
      addAssincronia(
        "Aumento de resistência de via aérea (mecânica respiratória)",
        "Limitação ao fluxo com padrão ‘achatado/quadrado’.",
        "Geralmente considerar: avaliar broncoespasmo/obstrução conforme prescrição; otimizar tempo expiratório e revisar secreção/patência do tubo/circuito."
      );
      hipoteses.push("Resistência aumentada (ex.: broncoespasmo/obstrução), dependendo do contexto.");
      achados.push(Padrão “raiz quadrada” → limitação ao fluxo / resistência aumentada. ${notaContexto("Correlacionar com clínica, ausculta e pressões.")});
    }

    if ($("spikeSaida").checked) {
      sinais.push("Spike no fim da inspiração (transição para expiração).");
      addAssincronia(
        "Transição inspiração→expiração instável (contextual)",
        "Espícula no fim do ciclo.",
        "Geralmente considerar: revisar término/ciclagem e suavidade de transição; correlacionar com esforço no fim da inspiração e com o modo."
      );
      hipoteses.push("Transição abrupta/instabilidade na troca de fase; correlacionar com modo e interação paciente–ventilador.");
      achados.push(Spike na saída (pressão) → espícula no fim da inspiração. ${notaContexto("Sugere instabilidade na troca de fase; avaliar contexto.")});
    }

    if ($("overshoot").checked) {
      const tipo = valRadio("ov_tipo") || "entrada";
      if (tipo === "entrada") {
        sinais.push("Overshoot na entrada: pressão passa do alvo no início e retorna.");
        addAssincronia(
          "Overshoot de entrada (subida agressiva/oscilações)",
          "Pressão excede o alvo no início do ciclo.",
          "Geralmente considerar: suavizar a subida (ex.: ajustar rise time/pressurização) e revisar possíveis oscilações do sistema/circuito."
        );
        hipoteses.push("Subida agressiva (rise curto) e/ou oscilação do sistema.");
        achados.push(Overshoot (entrada) → excede o alvo no início e retorna. ${notaContexto("Mais ligado a subida agressiva/oscilações.")});
      } else {
        sinais.push("Overshoot na saída: pressão passa do alvo no fim/ciclagem e retorna.");
        addAssincronia(
          "Overshoot de saída (troca de fase instável)",
          "Pressão excede o alvo no fim/ciclagem.",
          "Geralmente considerar: revisar término/ciclagem e interação no fim da inspiração; ajustar parâmetros que reduzam instabilidade na troca de fase, conforme modo."
        );
        hipoteses.push("Instabilidade na troca de fase e/ou interação com esforço no fim da inspiração.");
        achados.push(Overshoot (saída) → excede o alvo no fim/ciclagem e retorna. ${notaContexto("Mais ligado à troca de fase e ciclagem.")});
      }
    }

    if ($("degrauRecorrente").checked) {
      sinais.push("Degrau recorrente no fluxo mesmo após aspiração.");
      addAssincronia(
        "Obstrução/secreção persistente (contextual)",
        "Degraus persistem após aspiração.",
        "Geralmente considerar: reavaliar patência do tubo/circuito e secreção persistente; repetir higiene brônquica/aspiração conforme avaliação clínica e investigar causa de obstrução contínua."
      );
      hipoteses.push("Persistência de secreção/obstrução/patência comprometida; correlacionar com pressões e clínica.");
      achados.push(Degrau recorrente após aspiração → padrão persistente. ${notaContexto("Sugere fator persistente; correlacionar com clínica.")});
    }

    // ===================== SAÍDAS =====================
    if (achados.length === 0) {
      resultadoEl.innerHTML = Tipo de ciclo: ${labelTipoCiclo(tipoCiclo)}. Nenhum achado selecionado.;
      detalhesEl.innerHTML = "";
      resumoBox.style.display = "none";
      return;
    }

    resultadoEl.innerHTML = Tipo de ciclo: ${labelTipoCiclo(tipoCiclo)}. Interpretação sugerida:;
    detalhesEl.innerHTML = "<ul><li>" + achados.join("</li><li>") + "</li></ul>";

    const sinaisU = unique(sinais);
    const assincriasU = mapToArray(assincroniaMap);
    const correcoesU = mapToArray(correcaoMap);
    const hipU = unique(hipoteses);

    resumoBox.style.display = "block";
    listaSinais.innerHTML = "<li>" + sinaisU.join("</li><li>") + "</li>";
    listaAssincronias.innerHTML = "<li>" + assincriasU.join("</li><li>") + "</li>";
    listaCorrecoes.innerHTML = "<li>" + correcoesU.join("</li><li>") + "</li>";
    listaHipoteses.innerHTML = "<li>" + hipU.join("</li><li>") + "</li>";
    notaCtx.textContent = notaResumo();
  }

  // botão
  $("btnRodar").addEventListener("click", rodarAnalise);
</script>

<footer>
  <p>
    <strong>Aviso educacional:</strong><br>
    Este material tem finalidade exclusivamente educacional e de apoio ao raciocínio clínico.
    Não substitui a avaliação individual do paciente, o julgamento do profissional de saúde
    ou protocolos institucionais. As interpretações e ajustes devem ser correlacionados com o
    contexto clínico e ventilatório.
  </p>

  <p>
    <strong>Autoria:</strong> Leticia Moreira.<br>
    © 2026 Leticia Moreira – Todos os direitos reservados.<br>
    Uso permitido para fins educacionais e não comerciais, com citação da autora.
    É vedada a reprodução, distribuição ou modificação para fins comerciais sem autorização expressa.
  </p>
</footer>

</body>
</html>
