<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Teste – Assincronias Ventilatórias</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  body { font-family: Arial, sans-serif; padding: 20px; background:#fff; color:#111827; }
  h1 { font-size: 22px; margin: 0 0 6px; }
  p { color:#4b5563; margin: 0 0 16px; line-height:1.4; }

  .card { border:1px solid #e5e7eb; border-radius:10px; padding:14px; margin-bottom:14px; background:#f9fafb; }
  label { font-weight:700; display:block; }
  .legend { font-size:13px; color:#374151; margin-top:6px; line-height:1.4; }

  .controls { margin-top:10px; padding-top:10px; border-top:1px dashed #d1d5db; display:none; }
  select { margin-top:6px; font-size:14px; }

  .radio-line { display:flex; gap:14px; flex-wrap:wrap; margin-top:8px; }
  .radio-line label { font-weight:400; color:#111827; }

  button { padding:10px 14px; font-size:16px; margin-top:8px; cursor:pointer; }

  .resultado { margin-top:20px; font-weight:700; }
  .detalhes { margin-top:12px; font-weight:400; }
  ul { margin-left:18px; }

  .pill { display:inline-block; font-size:12px; padding:3px 8px; border:1px solid #e5e7eb; border-radius:999px; background:#fff; color:#4b5563; margin-left:8px; }
  .kicker { font-size:12px; color:#6b7280; margin-top:6px; }

  .debug { margin-top:14px; font-size:12px; color:#991b1b; background:#fff1f2; border:1px solid #fecdd3; padding:10px; border-radius:10px; display:none; }

  footer { margin-top:40px; padding-top:16px; border-top:1px solid #e5e7eb; font-size:12px; color:#4b5563; line-height:1.5; }
</style>
</head>

<body>

<h1>Teste clínico – Assincronias Ventilatórias</h1>
<p>
  1) Selecione o <b>tipo de ciclo</b>. 2) Marque os achados e, quando aplicável, indique “onde”.
  O motor descreve o <b>sinal no traçado</b>, sugere <b>padrões/assincronias prováveis</b>, lista <b>hipóteses</b> e traz um <b>resumo de ajustes possíveis</b> (educacional).
</p>

<div class="card">
  <label>Tipo de ciclo observado <span class="pill">Obrigatório</span></label>
  <div class="legend">
    Ajuda a interpretar o traçado: se o ciclo foi iniciado pelo ventilador (mandatório) ou pelo paciente (assistido), ou se há mistura.
  </div>
  <div class="radio-line">
    <label><input type="radio" name="tipoCiclo" value="mandatorio" /> Mandatório (a tempo)</label>
    <label><input type="radio" name="tipoCiclo" value="assistido" /> Assistido (disparado pelo paciente)</label>
    <label><input type="radio" name="tipoCiclo" value="misto" /> Misto (mandatórios + assistidos)</label>
    <label><input type="radio" name="tipoCiclo" value="nao_sei" /> Não sei</label>
  </div>
</div>

<!-- DISPARO REVERSO (com opções visíveis ao marcar) -->
<div class="card">
  <label><input type="checkbox" id="rt_habilitar"> Disparo reverso (Reverse Triggering) <span class="pill">Padrão</span></label>
  <div class="legend">
    Suspeite quando um ciclo <b>mandatório</b> é seguido de um <b>segundo esforço inspiratório dentro do mesmo ciclo</b>, com ou sem ciclo duplo.
  </div>

  <div class="controls" id="ctl_rt">
    <div class="legend"><b>Opções do padrão (marque o que você vê):</b></div>

    <label style="margin-top:10px;">
      <input type="checkbox" id="rt_segundoEsforco_pressao">
      Pressão: entalhe/queda durante a inspiração (meio/fim)
    </label>
    <div class="legend">
      Ex.: entalhe no platô (pode lembrar “M”), sem necessariamente gerar um novo ciclo.
    </div>

    <label style="margin-top:10px;">
      <input type="checkbox" id="rt_segundoEsforco_fluxo">
      Fluxo: segunda elevação do fluxo inspiratório (meio/fim)
    </label>
    <div class="legend">
      O fluxo inspiratório “volta a subir” dentro do mesmo ciclo (segundo esforço), sem novo disparo.
    </div>

    <label style="margin-top:10px;">
      <input type="checkbox" id="rt_acoplamento">
      Repetitivo e acoplado aos mandatórios
    </label>
    <div class="legend">
      Ocorre em vários ciclos consecutivos, com atraso semelhante após o início do ciclo mandatório.
    </div>

    <div style="margin-top:10px;">
      Padrão de acoplamento:
      <select id="rt_padrao">
        <option value="incerto">Incerto</option>
        <option value="1:1">1:1</option>
        <option value="1:2">1:2</option>
        <option value="1:3">1:3</option>
      </select>
    </div>

    <label style="margin-top:10px;">
      <input type="checkbox" id="rt_cicloDuplo">
      Há ciclo duplo (double triggering)
    </label>

    <label style="margin-top:10px;">
      <input type="checkbox" id="rt_emMandatorios">
      Vejo isso principalmente nos ciclos mandatórios (a tempo)
    </label>
    <div class="legend">
      Útil quando o traçado é misto e você consegue separar mandatórios de assistidos.
    </div>
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="degrauExp"> Degrau expiratório <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> “degrau”/entalhe no ramo expiratório (queda do fluxo não é suave). <b>Inespecífico.</b>
  </div>
  <div class="controls" id="ctl_degrauExp">
    Em que parte da expiração?
    <select id="degrauExp_local">
      <option value="início">Início</option>
      <option value="meio">Meio</option>
      <option value="final">Final</option>
    </select>
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="picoAbaulado"> Pico inspiratório abaulado <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> pico inspiratório arredondado (sem “ponta”). Pode sugerir demanda maior que oferta e/ou resistência aumentada (dependente do modo).
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="abaulamentoPlatoFluxo"> Abaulamento do fluxo inspiratório <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> o fluxo inspiratório “volta a subir”/faz “barriga” no meio/fim da inspiração.
  </div>
  <div class="controls" id="ctl_abaulamentoPlatoFluxo">
    Onde ocorre mais?
    <select id="abaulamentoPlato_local">
      <option value="no início">No início</option>
      <option value="no meio">No meio</option>
      <option value="no final">No final</option>
    </select>
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="ciclagemPrecoce"> Ciclagem precoce <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> a inspiração termina com fluxo inspiratório ainda positivo (não chega perto de zero).
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="ciclagemTardia"> Ciclagem tardia <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> a inspiração persiste apesar de o fluxo já estar ~zero.
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="letraM"> Entalhe no platô de pressão (“Letra M”) <span class="pill">Pressão</span></label>
  <div class="legend">
    <b>Sinal:</b> entalhe no platô inspiratório com retorno, lembrando “M”. <b>Não é</b> dois picos e <b>não é</b> ciclo duplo.
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="concavidade"> Concavidade no fluxo <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> a curva “afunda” (concava).
  </div>
  <div class="controls" id="ctl_concavidade">
    Onde aparece?
    <select id="concavidade_fase">
      <option value="inspiração">Inspiração</option>
      <option value="expiração">Expiração</option>
    </select>
    <select id="concavidade_local">
      <option value="no início">Início</option>
      <option value="no meio">Meio</option>
      <option value="no final">Final</option>
    </select>
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="convexidade"> Convexidade no fluxo <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> a curva “abaula para fora” (convexa).
  </div>
  <div class="controls" id="ctl_convexidade">
    Onde aparece?
    <select id="convexidade_fase">
      <option value="inspiração">Inspiração</option>
      <option value="expiração">Expiração</option>
    </select>
    <select id="convexidade_local">
      <option value="no início">Início</option>
      <option value="no meio">Meio</option>
      <option value="no final">Final</option>
    </select>
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="fluxoTremidoExp"> Fluxo expiratório serrilhado (“tremido”) <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> oscilações repetidas no ramo expiratório. Sugere secreção/condensado/interferência no circuito (correlacionar com clínica).
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="raizQuadrada"> Padrão “raiz quadrada” (limitação de fluxo / resistência) <span class="pill">Mecânica</span></label>
  <div class="legend">
    <b>Sinal:</b> traçado “achatado/quadrado” compatível com limitação ao fluxo e aumento de resistência (ex.: broncoespasmo/obstrução), dependendo do contexto.
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="spikeSaida"> Spike na saída (fim da inspiração) <span class="pill">Pressão</span></label>
  <div class="legend">
    <b>Sinal:</b> espícula curta no fim da inspiração (troca para expiração).
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="overshoot"> Overshoot de pressão <span class="pill">Pressão</span></label>
  <div class="legend">
    <b>Sinal:</b> pressão passa do alvo e retorna. Pode ser na entrada (subida) ou na saída (troca de fase).
  </div>
  <div class="controls" id="ctl_overshoot">
    Onde ocorre?
    <div class="radio-line">
      <label><input type="radio" name="ov_tipo" value="entrada" checked /> Entrada</label>
      <label><input type="radio" name="ov_tipo" value="saida" /> Saída</label>
    </div>
  </div>
</div>

<div class="card">
  <label><input type="checkbox" id="degrauRecorrente"> Degrau recorrente após aspiração <span class="pill">Fluxo</span></label>
  <div class="legend">
    <b>Sinal:</b> degraus persistem após aspiração, sugerindo fator persistente (secreção/obstrução/patência).
  </div>
</div>

<!-- Botão com onclick (redundância proposital para evitar falha de bind) -->
<button id="btnRodar" onclick="rodarAnalise(); return false;">Rodar análise</button>

<div class="resultado" id="resultado"></div>
<div class="debug" id="debugBox"></div>

<div class="card" id="resumoExecutivo" style="display:none;">
  <label>Resumo executivo</label>
  <div class="legend">
    Linguagem simples (mas técnica): sinais observados, padrão/assincronia provável e ajustes geralmente considerados.
  </div>
  <div class="detalhes">
    <p><b>1) Sinais no traçado:</b></p>
    <ul id="listaSinais"></ul>

    <p style="margin-top:10px;"><b>2) Padrão/assincronia provável:</b></p>
    <ul id="listaAssincronias"></ul>

    <p style="margin-top:10px;"><b>3) Ajustes geralmente considerados (resumo):</b></p>
    <ul id="listaCorrecoes"></ul>

    <p style="margin-top:10px;"><b>4) Hipóteses:</b></p>
    <ul id="listaHipoteses"></ul>

    <p class="kicker" id="notaContextoResumo"></p>
  </div>
</div>

<div class="card" id="propostasMelhoria">
  <label>Propostas de melhoria do motor</label>
  <div class="legend">
    Objetivo: aumentar a confiabilidade e deixar a saída mais guiada, sem perder rigor técnico.
  </div>
  <div class="detalhes">
    <ul>
      <li><b>Escolha do modo ventilatório</b> (VCV/PCV/PSV/PRVC): o motor só sugere ajustes compatíveis com o modo.</li>
      <li><b>Parâmetros opcionais</b> (Ti, rise/pressurização, trigger, % ciclagem, FR/VT, PEEP): melhora a precisão do “o que ajustar”.</li>
      <li><b>Confirmar em mais de uma curva</b> (pressão + fluxo): antes de “batizar” a assincronia, reduzir falso positivo.</li>
      <li><b>Grau de confiança</b> (baixa/média/alta): baseado em critérios objetivos (ex.: disparo reverso exige “segundo esforço” + repetição + mandatório).</li>
      <li><b>Saída em passos</b> (sinal → padrão → hipótese → ajuste): deixa a lógica transparente e didática.</li>
      <li><b>Copiar/Exportar resumo</b>: para discussão de caso/aula/checklist.</li>
      <li><b>Exemplos visuais</b> por achado: miniaturas para facilitar reconhecimento.</li>
      <li><b>Versão do motor</b>: rastreabilidade e controle de qualidade educacional.</li>
    </ul>
  </div>
</div>

<script>
(function () {
  "use strict";

  // Debug: mostrar erro em tela (para você não depender do console)
  const debugBox = document.getElementById("debugBox");
  function showError(msg) {
    debugBox.style.display = "block";
    debugBox.textContent = msg;
  }
  window.onerror = function (message, source, lineno, colno) {
    showError(`Erro de JavaScript: ${message} (linha ${lineno}:${colno})`);
  };

  const $ = (id) => document.getElementById(id);

  function getTipoCiclo() {
    const el = document.querySelector('input[name="tipoCiclo"]:checked');
    return el ? el.value : null;
  }
  function valRadio(name){
    const el = document.querySelector(`input[name="${name}"]:checked`);
    return el ? el.value : null;
  }
  function labelTipoCiclo(v){
    if (v === "mandatorio") return "Mandatório (a tempo)";
    if (v === "assistido") return "Assistido (disparado pelo paciente)";
    if (v === "misto") return "Misto (mandatórios + assistidos)";
    if (v === "nao_sei") return "Não informado / não sei";
    return "Não selecionado";
  }
  function unique(arr) {
    const seen = new Set();
    const out = [];
    arr.forEach(x => {
      const k = String(x).trim();
      if (!k) return;
      if (!seen.has(k)) { seen.add(k); out.push(k); }
    });
    return out;
  }
  function mapToArray(map) {
    const out = [];
    for (const [k, v] of map.entries()) out.push(v ? `${k} — ${v}` : k);
    return out;
  }

  // Toggles: adiciona listeners e sincroniza estado inicial
  const toggles = [
    ["rt_habilitar", "ctl_rt"],
    ["degrauExp", "ctl_degrauExp"],
    ["abaulamentoPlatoFluxo", "ctl_abaulamentoPlatoFluxo"],
    ["concavidade", "ctl_concavidade"],
    ["convexidade", "ctl_convexidade"],
    ["overshoot", "ctl_overshoot"]
  ];

  function bindToggles() {
    toggles.forEach(([cbId, ctlId]) => {
      const cb = $(cbId);
      const ctl = $(ctlId);
      if (!cb || !ctl) {
        // se algo estiver faltando, mostra no debug
        showError(`Elemento não encontrado: ${!cb ? cbId : ctlId}`);
        return;
      }
      const sync = () => { ctl.style.display = cb.checked ? "block" : "none"; };
      cb.addEventListener("change", sync);
      sync(); // estado inicial
    });
  }

  // Expor rodarAnalise no escopo global (para onclick e para o botão)
  window.rodarAnalise = function rodarAnalise() {
    try {
      debugBox.style.display = "none";
      debugBox.textContent = "";

      const tipoCiclo = getTipoCiclo();
      const resultadoEl = $("resultado");
      const resumoBox = $("resumoExecutivo");
      const listaSinais = $("listaSinais");
      const listaAssincronias = $("listaAssincronias");
      const listaCorrecoes = $("listaCorrecoes");
      const listaHipoteses = $("listaHipoteses");
      const notaCtx = $("notaContextoResumo");

      if (!tipoCiclo) {
        resultadoEl.innerHTML = "Selecione o tipo de ciclo (mandatório, assistido, misto ou não sei) antes de rodar a análise.";
        resumoBox.style.display = "none";
        return;
      }

      const conservador = (tipoCiclo === "nao_sei");
      const misto = (tipoCiclo === "misto");

      function notaResumo() {
        if (conservador) return "Nota: tipo de ciclo não informado; sugestões mais gerais e dependentes do modo ventilatório.";
        if (misto) return "Nota: em traçado misto, confirme ciclo a ciclo (mandatório vs assistido).";
        return "";
      }

      const sinais = [];
      const hipoteses = [];
      const assincroniaMap = new Map();
      const correcaoMap = new Map();

      function add(nome, justificativa, correcao) {
        if (!assincroniaMap.has(nome)) assincroniaMap.set(nome, justificativa || "");
        if (!correcaoMap.has(nome)) correcaoMap.set(nome, correcao || "");
      }

      // ===== DISPARO REVERSO =====
      if ($("rt_habilitar").checked) {
        const sPressao = $("rt_segundoEsforco_pressao").checked;
        const sFluxo   = $("rt_segundoEsforco_fluxo").checked;
        const acopl    = $("rt_acoplamento").checked;
        const padrao   = $("rt_padrao").value;
        const duplo    = $("rt_cicloDuplo").checked;
        const emMand   = $("rt_emMandatorios").checked;

        const reforcoMandatorio = (tipoCiclo === "mandatorio") || emMand || (tipoCiclo === "misto");
        const temSegundoEsforco = (sPressao || sFluxo);

        if (sPressao) sinais.push("Disparo reverso: entalhe/queda na pressão durante a inspiração (meio/fim).");
        if (sFluxo)   sinais.push("Disparo reverso: segunda elevação do fluxo inspiratório (meio/fim).");
        if (acopl)    sinais.push(`Disparo reverso: repetitivo e acoplado (${padrao}).`);
        if (duplo)    sinais.push("Disparo reverso: com ciclo duplo.");

        const criterios = (reforcoMandatorio && temSegundoEsforco && acopl);
        if (criterios) {
          add(
            duplo
              ? "Disparo reverso (reverse triggering) — com ciclo duplo"
              : "Disparo reverso (reverse triggering) — sem ciclo duplo",
            "Critérios presentes: padrão em mandatórios + segundo esforço + repetição/acoplamento.",
            "Rever entrainment: avaliar FR/Ti dos mandatórios (quando aplicável), conforto/drive (sedação/analgesia conforme objetivos) e confirmar padrão em pressão e fluxo ciclo a ciclo."
          );
          hipoteses.push("Entrainment: o ciclo mandatório pode induzir esforço neural secundário dentro do mesmo ciclo.");
        } else {
          add(
            "Suspeita de disparo reverso (critérios incompletos)",
            "Para concluir: é preciso (1) ver o segundo esforço (pressão e/ou fluxo) e (2) repetição/acoplamento em mandatórios.",
            "Complete os itens do bloco (segundo esforço + acoplamento) e confirme se ocorre nos ciclos mandatórios."
          );
        }
      }

      // ===== OUTROS ACHADOS =====
      if ($("degrauExp").checked) {
        const local = $("degrauExp_local").value;
        sinais.push(`Degrau/entalhe no ramo expiratório (${local}).`);
        add(
          "Alteração expiratória / possível auto-PEEP (contextual)",
          "Degrau no ramo expiratório (inespecífico).",
          "Em geral: otimizar tempo expiratório (Ti/FR/VT conforme modo), avaliar broncoobstrução/secreções e considerar PEEP externa se indicado e se houver auto-PEEP."
        );
        hipoteses.push("Esvaziamento expiratório comprometido (auto-PEEP/dinâmica expiratória desfavorável/esforço expiratório ativo).");
      }

      if ($("picoAbaulado").checked) {
        sinais.push("Pico inspiratório arredondado/abaulado no fluxo.");
        add(
          "Fluxo insuficiente / demanda maior que oferta (contextual)",
          "Pico inspiratório arredondado.",
          "Em geral: aumentar oferta de fluxo (VCV) ou ajustar pressurização/rise time (modos a pressão) e checar resistência/obstrução."
        );
        hipoteses.push("Demanda inspiratória pode exceder oferta; considerar resistência/obstrução.");
      }

      if ($("abaulamentoPlatoFluxo").checked) {
        const local = $("abaulamentoPlato_local").value;
        sinais.push(`Fluxo inspiratório volta a subir (${local}).`);
        add(
          "Fome de fluxo ao longo da inspiração (contextual)",
          "Re-elevação do fluxo no meio/fim.",
          "Em geral: ajustar fluxo (VCV) ou pressurização/rise time (PCV/PSV) para acompanhar demanda; correlacionar com esforço."
        );
        hipoteses.push("Demanda inspiratória variável durante a inspiração.");
      }

      if ($("ciclagemPrecoce").checked) {
        sinais.push("Término inspiratório com fluxo ainda positivo.");
        add(
          "Ciclagem precoce",
          "Inspiração termina antes do fluxo cair próximo de zero.",
          "Em geral: prolongar Ti ou reduzir sensibilidade de ciclagem (ex.: reduzir % ciclagem em PSV), conforme modo."
        );
        hipoteses.push("Término inspiratório antes da demanda do paciente.");
      }

      if ($("ciclagemTardia").checked) {
        sinais.push("Inspiração mantida apesar de fluxo ~zero.");
        add(
          "Ciclagem tardia",
          "Inspiração persiste mesmo com fluxo ~zero.",
          "Em geral: reduzir Ti ou aumentar sensibilidade de ciclagem (ex.: aumentar % ciclagem em PSV), conforme modo."
        );
        hipoteses.push("Inspiração prolongada além do necessário.");
      }

      if ($("letraM").checked) {
        sinais.push("Entalhe no platô inspiratório da pressão (forma em M).");
        add(
          "Interferência de esforço durante a inspiração (Letra M)",
          "Entalhe no platô durante a inspiração.",
          "Em geral: revisar sincronização (trigger, pressurização, término/ciclagem) e conforto/drive. Se repetitivo em mandatórios, avaliar disparo reverso."
        );
        hipoteses.push("Esforço/demanda do paciente durante a inspiração.");
      }

      if ($("concavidade").checked) {
        const fase = $("concavidade_fase").value;
        const local = $("concavidade_local").value;
        sinais.push(`Concavidade no fluxo na ${fase} (${local}).`);
        add(
          "Demanda/esforço modulando o fluxo (contextual)",
          "Concavidade sugere modulação por esforço/demanda.",
          "Em geral: correlacionar com modo e conforto; revisar assistência (trigger, pressurização/fluxo, ciclagem) se houver desconforto/assincronia."
        );
        hipoteses.push("Modulação por esforço/demanda; interpretar com modo e demais curvas.");
      }

      if ($("convexidade").checked) {
        const fase = $("convexidade_fase").value;
        const local = $("convexidade_local").value;
        sinais.push(`Convexidade no fluxo na ${fase} (${local}).`);
        add(
          "Padrão mais imposto / possível sobreassistência (contextual)",
          "Convexidade pode refletir padrão mais imposto.",
          "Em geral: reavaliar nível de assistência e sincronização; evitar sobreassistência conforme metas ventilatórias."
        );
        hipoteses.push("Padrão mais imposto/assistido; depende do modo/contexto.");
      }

      if ($("fluxoTremidoExp").checked) {
        sinais.push("Fluxo expiratório serrilhado (“tremido”).");
        add(
          "Sinal compatível com secreção/condensado (não é assincronia clássica)",
          "Oscilações no ramo expiratório.",
          "Em geral: checar secreção/condensado e patência do circuito/tubo; considerar aspiração/higiene brônquica conforme avaliação clínica."
        );
        hipoteses.push("Secreções/condensado/interferência no circuito.");
      }

      if ($("raizQuadrada").checked) {
        sinais.push("Padrão ‘raiz quadrada’ (limitação ao fluxo / resistência).");
        add(
          "Aumento de resistência de via aérea (mecânica)",
          "Limitação ao fluxo sugerindo resistência aumentada.",
          "Em geral: avaliar broncoespasmo/obstrução conforme prescrição; otimizar tempo expiratório e revisar secreção/patência."
        );
        hipoteses.push("Resistência aumentada (broncoespasmo/obstrução), conforme contexto.");
      }

      if ($("spikeSaida").checked) {
        sinais.push("Spike no fim da inspiração (saída).");
        add(
          "Transição inspiração→expiração instável (contextual)",
          "Espícula no fim do ciclo.",
          "Em geral: revisar término/ciclagem e suavidade de transição; correlacionar com modo e esforço no fim da inspiração."
        );
        hipoteses.push("Troca de fase instável/abrupta.");
      }

      if ($("overshoot").checked) {
        const tipo = valRadio("ov_tipo") || "entrada";
        if (tipo === "entrada") {
          sinais.push("Overshoot na entrada (subida): pressão passa do alvo no início e retorna.");
          add(
            "Overshoot de entrada",
            "Subida agressiva/oscilações na pressurização.",
            "Em geral: suavizar subida (ajustar rise/pressurização) e revisar oscilações do sistema/circuito."
          );
          hipoteses.push("Subida agressiva e/ou oscilação do sistema.");
        } else {
          sinais.push("Overshoot na saída (troca de fase): pressão passa do alvo no fim/ciclagem e retorna.");
          add(
            "Overshoot de saída",
            "Instabilidade na troca de fase.",
            "Em geral: revisar término/ciclagem e parâmetros que reduzam instabilidade na troca de fase, conforme modo."
          );
          hipoteses.push("Instabilidade na troca de fase e/ou interação com esforço no fim da inspiração.");
        }
      }

      if ($("degrauRecorrente").checked) {
        sinais.push("Degrau recorrente após aspiração.");
        add(
          "Obstrução/secreção persistente (contextual)",
          "Degraus persistem após aspiração.",
          "Em geral: reavaliar patência do tubo/circuito e secreção persistente; repetir higiene brônquica/aspiração conforme avaliação clínica."
        );
        hipoteses.push("Persistência de secreção/obstrução/patência comprometida.");
      }

      // ===== SAÍDA =====
      const sinaisU = unique(sinais);
      const assinU = mapToArray(assincroniaMap);
      const corrU = mapToArray(correcaoMap);
      const hipU = unique(hipoteses);

      if (sinaisU.length === 0) {
        resultadoEl.innerHTML = `Tipo de ciclo: ${labelTipoCiclo(tipoCiclo)}. Nenhum achado selecionado.`;
        resumoBox.style.display = "none";
        return;
      }

      $("resultado").innerHTML = `Tipo de ciclo: ${labelTipoCiclo(tipoCiclo)}. Resultado:`;
      $("resumoExecutivo").style.display = "block";
      listaSinais.innerHTML = "<li>" + sinaisU.join("</li><li>") + "</li>";
      listaAssincronias.innerHTML = "<li>" + assinU.join("</li><li>") + "</li>";
      listaCorrecoes.innerHTML = "<li>" + corrU.join("</li><li>") + "</li>";
      listaHipoteses.innerHTML = "<li>" + hipU.join("</li><li>") + "</li>";
      notaCtx.textContent = notaResumo();
    } catch (e) {
      showError("Falha ao rodar a análise: " + (e && e.message ? e.message : String(e)));
    }
  };

  function bindButton() {
    const btn = $("btnRodar");
    if (btn) btn.addEventListener("click", function (ev) { ev.preventDefault(); window.rodarAnalise(); });
  }

  document.addEventListener("DOMContentLoaded", function () {
    bindToggles();
    bindButton();
  });

  // Também inicializa imediatamente (caso DOMContentLoaded já tenha ocorrido)
  if (document.readyState === "interactive" || document.readyState === "complete") {
    bindToggles();
    bindButton();
  }
})();
</script>

<footer>
  <p>
    <strong>Aviso educacional:</strong><br>
    Este material tem finalidade exclusivamente educacional e de apoio ao raciocínio clínico.
    Não substitui a avaliação individual do paciente, o julgamento do profissional de saúde
    ou protocolos institucionais. As interpretações e ajustes devem ser correlacionados com o
    contexto clínico e ventilatório.
  </p>

  <p>
    <strong>Autoria:</strong> Leticia Moreira.<br>
    © 2026 Leticia Moreira – Todos os direitos reservados.<br>
    Uso permitido para fins educacionais e não comerciais, com citação da autora.
    É vedada a reprodução, distribuição ou modificação para fins comerciais sem autorização expressa.
  </p>
</footer>

</body>
</html>
