<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Teste – Assincronias Ventilatórias</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  body { font-family: Arial, sans-serif; padding: 20px; background:#fff; color:#111827; }
  h1 { font-size: 22px; margin: 0 0 6px; }
  p { color:#4b5563; margin: 0 0 16px; line-height:1.4; }

  .card { border:1px solid #e5e7eb; border-radius:10px; padding:14px; margin-bottom:14px; background:#f9fafb; }
  label { font-weight:700; display:block; }
  .legend { font-size:13px; color:#374151; margin-top:6px; line-height:1.4; }

  .controls { margin-top:10px; padding-top:10px; border-top:1px dashed #d1d5db; display:none; }
  select { margin-top:6px; font-size:14px; }
  .radio-line { display:flex; gap:14px; flex-wrap:wrap; margin-top:8px; }
  .radio-line label { font-weight:400; color:#111827; }

  button { padding:10px 14px; font-size:16px; margin-top:8px; cursor:pointer; }

  .resultado { margin-top:20px; font-weight:700; }
  .detalhes { margin-top:12px; font-weight:400; }
  ul { margin-left:18px; }

  .pill { display:inline-block; font-size:12px; padding:3px 8px; border:1px solid #e5e7eb; border-radius:999px; background:#fff; color:#4b5563; margin-left:8px; }
  .kicker { font-size:12px; color:#6b7280; margin-top:6px; }

  footer { margin-top:40px; padding-top:16px; border-top:1px solid #e5e7eb; font-size:12px; color:#4b5563; line-height:1.5; }
</style>
</head>

<body>

<h1>Teste clínico – Assincronias Ventilatórias</h1>
<p>
  1) Selecione o <b>tipo de ciclo</b>. 2) Marque os achados e, quando aplicável, especifique “onde”.
  O motor descreve o <b>sinal visual</b>, sugere <b>assincronia</b> (quando aplicável), lista <b>hipóteses</b> e mostra um resumo educacional de <b>como corrigir</b>.
</p>

<!-- CONTEXTO DO CICLO -->
<div class="card">
  <label>Contexto do ciclo observado <span class="pill">Obrigatório</span></label>
  <div class="legend">
    A leitura dos sinais depende se o traçado é mandatário (a tempo), assistido (disparado pelo paciente) ou misto.
  </div>
  <div class="radio-line">
    <label><input type="radio" name="tipoCiclo" value="mandatorio" /> Mandatório (a tempo)</label>
    <label><input type="radio" name="tipoCiclo" value="assistido" /> Assistido (disparado pelo paciente)</label>
    <label><input type="radio" name="tipoCiclo" value="misto" /> Misto (mandatórios + assistidos)</label>
    <label><input type="radio" name="tipoCiclo" value="nao_sei" /> Não sei</label>
  </div>
</div>

<!-- BLOCO ESPECÍFICO PARA DISPARO REVERSO -->
<div class="card">
  <label><input type="checkbox" id="rt_habilitar"> Avaliar Disparo Reverso (Reverse Triggering) <span class="pill">Padrão</span></label>
  <div class="legend">
    Use este bloco quando você suspeita que um ciclo <b>mandatório</b> esteja “puxando” um <b>segundo esforço</b> do paciente dentro da mesma inspiração (com ou sem ciclo duplo).
  </div>

  <div class="controls" id="ctl_rt">
    <div class="legend">
      <b>Selecione os sinais do padrão (quanto mais critérios, maior a confiança):</b>
    </div>

    <label style="margin-top:10px; font-weight:700;">
      <input type="checkbox" id="rt_segundoEsforco">
      Segundo esforço inspiratório durante a inspiração mandatória (sem novo ciclo)
    </label>
    <div class="legend">
      <b>Sinal visual:</b> entalhe/queda na pressão durante a inspiração <i>ou</i> nova elevação do fluxo inspiratório no meio/fim,
      porém <b>sem</b> disparar um novo ciclo.
    </div>

    <label style="margin-top:10px; font-weight:700;">
      <input type="checkbox" id="rt_acoplamento">
      Padrão repetitivo acoplado aos ciclos mandatórios
    </label>
    <div class="legend">
      Ex.: ocorre em vários ciclos consecutivos, com atraso semelhante em relação ao início do ciclo.
    </div>

    <div style="margin-top:10px;">
      Padrão de acoplamento:
      <select id="rt_padrao">
        <option value="incerto">Incerto</option>
        <option value="1:1">1:1 (quase todo ciclo mandatório)</option>
        <option value="1:2">1:2 (a cada 2 ciclos)</option>
        <option value="1:3">1:3 (a cada 3 ciclos)</option>
      </select>
    </div>

    <label style="margin-top:10px; font-weight:700;">
      <input type="checkbox" id="rt_cicloDuplo">
      Há ciclo duplo (double triggering) associado
    </label>
    <div class="legend">
      <b>Importante:</b> Disparo reverso pode ocorrer <b>com</b> ou <b>sem</b> ciclo duplo. Aqui você só classifica o fenótipo.
    </div>
  </div>
</div>

<!-- Degrau expiratório -->
<div class="card">
  <label><input type="checkbox" id="degrauExp"> Degrau expiratório <span class="pill">Curva de fluxo</span></label>
  <div class="legend">
    <b>Sinal visual:</b> entalhe/degrau (quebra de inclinação) no <b>ramo expiratório</b>, interrompendo a queda suave do fluxo expiratório.
    <br><b>Nota:</b> é um sinal inespecífico; sozinho <b>não</b> define disparo reverso.
  </div>
  <div class="controls" id="ctl_degrauExp">
    Parte da expiração:
    <select id="degrauExp_local">
      <option value="início">Início</option>
      <option value="meio">Meio</option>
      <option value="final">Final</option>
    </select>
  </div>
</div>

<!-- Pico inspiratório abaulado -->
<div class="card">
  <label><input type="checkbox" id="picoAbaulado"> Pico inspiratório abaulado <span class="pill">Curva de fluxo</span></label>
  <div class="legend">
    <b>Sinal visual:</b> pico de fluxo inspiratório <b>arredondado/abaulado</b> (pico “sem ponta”).
  </div>
</div>

<!-- Abaulamento do platô de fluxo inspiratório -->
<div class="card">
  <label><input type="checkbox" id="abaulamentoPlatoFluxo"> Abaulamento do platô de fluxo inspiratório <span class="pill">Curva de fluxo</span></label>
  <div class="legend">
    <b>Sinal visual:</b> durante a inspiração, observa-se <b>abaulamento</b> (fluxo “volta a subir” ou forma uma barriga).
    <br><b>Nota:</b> quando isso é repetitivo em ciclos mandatórios e aparece como “segundo esforço” dentro da inspiração, pode compor padrão de disparo reverso.
  </div>
  <div class="controls" id="ctl_abaulamentoPlatoFluxo">
    Onde ocorre mais?
    <select id="abaulamentoPlato_local">
      <option value="no início da inspiração">No início da inspiração</option>
      <option value="no meio da inspiração">No meio da inspiração</option>
      <option value="no final da inspiração">No final da inspiração</option>
    </select>
  </div>
</div>

<!-- Ciclagem precoce -->
<div class="card">
  <label><input type="checkbox" id="ciclagemPrecoce"> Ciclagem precoce <span class="pill">Curva de fluxo</span></label>
  <div class="legend">
    <b>Sinal visual da assincronia:</b> a inspiração termina com <b>fluxo inspiratório ainda positivo</b> (não chega próximo de zero).
  </div>
</div>

<!-- Ciclagem tardia -->
<div class="card">
  <label><input type="checkbox" id="ciclagemTardia"> Ciclagem tardia <span class="pill">Curva de fluxo</span></label>
  <div class="legend">
    <b>Sinal visual da assincronia:</b> o ventilador mantém inspiração apesar do fluxo inspiratório já ter atingido <b>~zero</b>.
  </div>
</div>

<!-- Letra M -->
<div class="card">
  <label><input type="checkbox" id="letraM"> Letra M (entalhe no platô) <span class="pill">Curva de pressão</span></label>
  <div class="legend">
    <b>Sinal visual:</b> no platô inspiratório da pressão, há um <b>entalhe</b> no meio com retorno, formando <b>“M”</b>.
    <b>Não</b> é “dois topos” e <b>não</b> corresponde a ciclos duplos.
    <br><b>Nota:</b> em ciclos mandatórios repetidos, pode ser a deformação da pressão causada pelo “segundo esforço” do disparo reverso.
  </div>
</div>

<!-- Concavidade no fluxo -->
<div class="card">
  <label><input type="checkbox" id="concavidade"> Concavidade no fluxo <span class="pill">Curva de fluxo</span></label>
  <div class="legend">
    <b>Sinal visual:</b> a curva “afunda” (concava) onde se esperaria trajetória mais linear/suave.
  </div>
  <div class="controls" id="ctl_concavidade">
    Onde aparece?
    <select id="concavidade_fase">
      <option value="inspiração">Inspiração</option>
      <option value="expiração">Expiração</option>
    </select>
    <select id="concavidade_local">
      <option value="no início">No início</option>
      <option value="no meio">No meio</option>
      <option value="no final">No final</option>
    </select>
  </div>
</div>

<!-- Convexidade no fluxo -->
<div class="card">
  <label><input type="checkbox" id="convexidade"> Convexidade no fluxo <span class="pill">Curva de fluxo</span></label>
  <div class="legend">
    <b>Sinal visual:</b> a curva “abaula para fora” (convexa) na fase selecionada.
  </div>
  <div class="controls" id="ctl_convexidade">
    Onde aparece?
    <select id="convexidade_fase">
      <option value="inspiração">Inspiração</option>
      <option value="expiração">Expiração</option>
    </select>
    <select id="convexidade_local">
      <option value="no início">No início</option>
      <option value="no meio">No meio</option>
      <option value="no final">No final</option>
    </select>
  </div>
</div>

<!-- Fluxo expiratório tremido -->
<div class="card">
  <label><input type="checkbox" id="fluxoTremidoExp"> Curva de fluxo expiratório “tremida” <span class="pill">Curva de fluxo</span></label>
  <div class="legend">
    <b>Sinal visual:</b> serrilhado/oscilações repetidas no <b>ramo expiratório</b>.
    <br><b>Interpretação típica:</b> secreções/condensado/interferência no tubo/circuito (correlacionar com ausculta e aspiração).
  </div>
</div>

<!-- Sinal de raiz quadrada -->
<div class="card">
  <label><input type="checkbox" id="raizQuadrada"> “Sinal de raiz quadrada” <span class="pill">Resistência de via aérea</span></label>
  <div class="legend">
    <b>Sinal visual:</b> traçado com aspecto “quadrado/achatado” compatível com <b>limitação ao fluxo</b>.
    <br><b>Interpretação típica:</b> compatível com broncoespasmo/obstrução (correlacionar com sibilância, pressões e clínica).
  </div>
</div>

<!-- Spike (pressão) - saída -->
<div class="card">
  <label><input type="checkbox" id="spikeSaida"> Spike (na saída) <span class="pill">Curva de pressão</span></label>
  <div class="legend">
    <b>Sinal visual:</b> espícula/pico curto de pressão no <b>fim da inspiração</b> (transição para expiração).
  </div>
</div>

<!-- Overshoot (pressão) - entrada ou saída -->
<div class="card">
  <label><input type="checkbox" id="overshoot"> Overshoot (pressão) <span class="pill">Curva de pressão</span></label>
  <div class="legend">
    <b>Sinal visual:</b> excesso transitório de pressão acima do alvo com retorno. Pode ocorrer na <b>entrada</b> ou <b>saída</b>.
  </div>
  <div class="controls" id="ctl_overshoot">
    Overshoot ocorre em:
    <div class="radio-line">
      <label><input type="radio" name="ov_tipo" value="entrada" checked /> Entrada (início / rise time)</label>
      <label><input type="radio" name="ov_tipo" value="saida" /> Saída (fim / ciclagem)</label>
    </div>
  </div>
</div>

<!-- Degrau recorrente pós-aspiração -->
<div class="card">
  <label><input type="checkbox" id="degrauRecorrente"> Degrau recorrente pós-aspiração <span class="pill">Curva de fluxo</span></label>
  <div class="legend">
    <b>Sinal visual:</b> degraus repetidos no fluxo após aspiração, sugerindo fator persistente.
  </div>
</div>

<button onclick="rodarAnalise()">Rodar análise</button>

<div class="resultado" id="resultado"></div>

<!-- RESUMO EXECUTIVO -->
<div class="card" id="resumoExecutivo" style="display:none;">
  <label>Resumo executivo</label>
  <div class="legend">
    Síntese dos principais sinais visuais, <b>nome(s) da(s) assincronia(s)</b> (quando aplicável) e um <b>resumo de como corrigir</b> (educacional; depende do modo/protocolo).
  </div>

  <div class="detalhes">
    <p><b>Principais sinais visuais identificados:</b></p>
    <ul id="listaSinais"></ul>

    <p style="margin-top:10px;"><b>Assincronia(s) sugerida(s):</b></p>
    <ul id="listaAssincronias"></ul>

    <p style="margin-top:10px;"><b>Como corrigir (resumo):</b></p>
    <ul id="listaCorrecoes"></ul>

    <p style="margin-top:10px;"><b>Hipóteses mais prováveis:</b></p>
    <ul id="listaHipoteses"></ul>

    <p class="kicker" id="notaContextoResumo"></p>
  </div>
</div>

<div class="detalhes" id="detalhes"></div>

<!-- PROPOSTAS DE MELHORIA (roadmap) -->
<div class="card" id="propostasMelhoria">
  <label>Propostas de melhoria (roadmap)</label>
  <div class="legend">
    Itens para aumentar a precisão do motor e padronizar “assincronia + correção resumida”, mantendo caráter educacional.
  </div>
  <div class="detalhes">
    <ul>
      <li><b>Selecionar modo ventilatório</b> (VCV/PCV/PSV/PRVC etc.) para personalizar correções (ex.: % ciclagem apenas em PSV).</li>
      <li><b>Parâmetros mínimos opcionais</b> (Ti, % ciclagem, rise time, trigger, FR/VT, PEEP) para tornar correções menos genéricas.</li>
      <li><b>Regras de compatibilidade</b> por contexto (mandatório/assistido/misto) para reduzir falso positivo de “assincronia”.</li>
      <li><b>Confirmação cruzada</b> entre curvas (pressão/fluxo/volume) antes de nomear a assincronia.</li>
      <li><b>Rótulo de confiança</b> (baixa/média/alta) por critérios convergentes e consistência com o contexto do ciclo.</li>
      <li><b>Exportar resumo executivo</b> (texto pronto para discussão de caso/aula).</li>
      <li><b>Biblioteca de exemplos</b> (miniaturas) por achado, exibidas ao marcar o checkbox.</li>
      <li><b>Versionamento</b> do motor e log de mudanças para rastreabilidade educacional.</li>
    </ul>
  </div>
</div>

<script>
  // Controles condicionais (expandir/colapsar)
  const toggles = [
    ["degrauExp", "ctl_degrauExp"],
    ["concavidade", "ctl_concavidade"],
    ["convexidade", "ctl_convexidade"],
    ["overshoot", "ctl_overshoot"],
    ["abaulamentoPlatoFluxo", "ctl_abaulamentoPlatoFluxo"],
    ["rt_habilitar", "ctl_rt"]
  ];

  toggles.forEach(([cbId, ctlId]) => {
    const cb = document.getElementById(cbId);
    const ctl = document.getElementById(ctlId);
    cb.addEventListener("change", () => {
      ctl.style.display = cb.checked ? "block" : "none";
    });
  });

  function getTipoCiclo() {
    const el = document.querySelector('input[name="tipoCiclo"]:checked');
    return el ? el.value : null;
  }

  function valRadio(name){
    const el = document.querySelector(input[name="${name}"]:checked);
    return el ? el.value : null;
  }

  function labelTipoCiclo(v){
    if (v === "mandatorio") return "Mandatório (a tempo)";
    if (v === "assistido") return "Assistido (disparado pelo paciente)";
    if (v === "misto") return "Misto (mandatórios + assistidos)";
    if (v === "nao_sei") return "Não informado / não sei";
    return "Não selecionado";
  }

  function unique(arr) {
    const seen = new Set();
    const out = [];
    arr.forEach(x => {
      const k = String(x).trim();
      if (!k) return;
      if (!seen.has(k)) { seen.add(k); out.push(k); }
    });
    return out;
  }

  function mapToArray(map) {
    const out = [];
    for (const [k, v] of map.entries()) out.push(v ? ${k} — ${v} : k);
    return out;
  }

  function rodarAnalise() {
    const tipoCiclo = getTipoCiclo();

    const achados = [];
    const sinais = [];
    const hipoteses = [];

    const assincroniaMap = new Map(); // nome -> justificativa
    const correcaoMap = new Map();    // nome -> correção

    const resumoBox = document.getElementById("resumoExecutivo");
    const listaSinais = document.getElementById("listaSinais");
    const listaAssincronias = document.getElementById("listaAssincronias");
    const listaCorrecoes = document.getElementById("listaCorrecoes");
    const listaHipoteses = document.getElementById("listaHipoteses");
    const notaCtx = document.getElementById("notaContextoResumo");

    if (!tipoCiclo) {
      resultado.innerHTML = "Selecione o tipo de ciclo (mandatório, assistido, misto ou não sei) antes de rodar a análise.";
      detalhes.innerHTML = "";
      resumoBox.style.display = "none";
      return;
    }

    const conservador = (tipoCiclo === "nao_sei");
    const misto = (tipoCiclo === "misto");

    function notaContexto(extra) {
      if (conservador) return "Interpretação conservadora (tipo de ciclo não informado). " + extra;
      if (misto) return "Ciclos mistos podem combinar padrões diferentes no mesmo traçado. " + extra;
      return extra;
    }

    function notaResumo() {
      if (conservador) return "Nota: tipo de ciclo não informado; correções apresentadas de forma conservadora e dependentes do modo ventilatório e protocolo local.";
      if (misto) return "Nota: traçado misto pode conter assincronias distintas em ciclos diferentes; correlacionar ciclo a ciclo.";
      return "";
    }

    function addAssincronia(nome, justificativa, correcao) {
      if (!assincroniaMap.has(nome)) assincroniaMap.set(nome, justificativa || "");
      if (!correcaoMap.has(nome)) correcaoMap.set(nome, correcao || "");
    }

    // ========== DISPARO REVERSO (Padrão) ==========
    if (rt_habilitar.checked) {
      const segundoEsforco = rt_segundoEsforco.checked;
      const acoplamento = rt_acoplamento.checked;
      const padrao = document.getElementById("rt_padrao").value;
      const cicloDuplo = rt_cicloDuplo.checked;

      const contextoOk = (tipoCiclo === "mandatorio" || tipoCiclo === "misto");
      let score = 0;
      if (contextoOk) score++;
      if (segundoEsforco) score++;
      if (acoplamento) score++;
      if (padrao !== "incerto") score++;

      if (segundoEsforco) sinais.push("Segundo esforço inspiratório dentro da mesma inspiração mandatória (sem novo ciclo), sugerindo entrainment.");
      if (acoplamento) sinais.push(Padrão repetitivo acoplado aos ciclos mandatórios (${padrao}).);
      if (cicloDuplo) sinais.push("Há ciclo duplo associado (fenótipo com double triggering).");

      // Só nomeia se tiver critérios mínimos
      if (contextoOk && segundoEsforco && acoplamento) {
        const confianca = (score >= 4) ? "alta" : "moderada";
        if (!cicloDuplo) {
          addAssincronia(
            "Disparo reverso (reverse triggering) sem ciclo duplo",
            Critérios atendidos (contexto mandatório/misto + segundo esforço + acoplamento). Confiança ${confianca}.,
            "Avaliar entrainment paciente–ventilador: revisar ajustes de ciclos mandatórios (FR/Ti) e contexto de drive/sedação; confirmar padrão em pressão e fluxo ciclo a ciclo."
          );
        } else {
          addAssincronia(
            "Disparo reverso (reverse triggering) com ciclo duplo",
            Critérios atendidos (contexto mandatório/misto + acoplamento). Confiança ${confianca}.,
            "Revisar entrainment e prevenir ciclo duplo: ajustar FR/Ti e critérios de término conforme modo, avaliar drive/sedação e confirmar padrão em pressão/fluxo ciclo a ciclo."
          );
        }
        hipoteses.push("Padrão compatível com entrainment: ciclo mandatório induz esforço neural secundário do paciente dentro da mesma inspiração.");
        achados.push("Disparo reverso → padrão de segundo esforço acoplado a ciclos mandatórios (com ou sem ciclo duplo).");
      } else if (rt_habilitar.checked) {
        // Habilitou mas não preencheu critérios mínimos
        addAssincronia(
          "Suspeita de disparo reverso (insuficiente para confirmar)",
          "Faltam critérios mínimos (precisa de contexto mandatório/misto + segundo esforço + acoplamento).",
          "Adicionar critérios: confirmar se é ciclo mandatório/misto, se há segundo esforço dentro da inspiração e se o padrão se repete de forma acoplada."
        );
      }
    }

    // ========== ACHADOS INDIVIDUAIS ==========
    if (degrauExp.checked) {
      const local = document.getElementById("degrauExp_local").value;
      sinais.push(Entalhe/degrau no ramo expiratório (${local}).);

      addAssincronia(
        "Assincronia expiratória / provável auto-PEEP (contextual)",
        "Degrau/entalhe no ramo expiratório (sinal inespecífico).",
        "Priorizar aumento de tempo expiratório (reduzir Ti e/ou ajustar FR/VT conforme protocolo e modo), tratar broncoobstrução/secreções e considerar PEEP externa se houver evidência de auto-PEEP e indicação clínica."
      );

      hipoteses.push("Alteração do esvaziamento expiratório (auto-PEEP, dinâmica expiratória desfavorável ou esforço expiratório ativo).");

      achados.push(
        `Degrau expiratório (fluxo) → entalhe no ramo expiratório (${local}). ` +
        notaContexto("Sinal inespecífico; não define disparo reverso isoladamente.")
      );
    }

    if (picoAbaulado.checked) {
      sinais.push("Pico inspiratório arredondado/abaulado no fluxo.");

      addAssincronia(
        "Fluxo insuficiente / fome de fluxo (contextual)",
        "Pico inspiratório abaulado/arredondado.",
        "Aumentar oferta de fluxo (VCV) ou ajustar pressurização/rise time (PCV/PSV) para reduzir demanda não atendida; correlacionar com resistência e conforto."
      );

      hipoteses.push("Demanda inspiratória pode exceder o fluxo ofertado; considerar também aumento de resistência/obstrução parcial (dependente do modo).");

      achados.push(
        `Pico inspiratório abaulado (fluxo) → pico inspiratório arredondado. ` +
        notaContexto("Compatível com fome de fluxo/fluxo insuficiente (dependente do modo) ou resistência aumentada.")
      );
    }

    if (abaulamentoPlatoFluxo.checked) {
      const local = document.getElementById("abaulamentoPlato_local").value;
      sinais.push(Abaulamento (“barriga”) no trecho inspiratório do fluxo (${local}).);

      addAssincronia(
        "Fome de fluxo intra-inspiratória (contextual)",
        "Fluxo re-sobe/abaula durante a inspiração.",
        "Rever oferta de fluxo/pressurização ao longo da inspiração (fluxo em VCV; rise/pressurização em PCV/PSV) e correlacionar com esforço do paciente."
      );

      hipoteses.push("Demanda inspiratória variável durante a inspiração; compatível com fome de fluxo em parte do ciclo (dependente do modo).");

      achados.push(
        `Abaulamento do platô de fluxo inspiratório → re-elevação/abaulamento do fluxo (${local}). ` +
        notaContexto("Em ciclos mandatórios repetidos, pode compor o padrão de disparo reverso quando associado a “segundo esforço” acoplado.")
      );
    }

    if (ciclagemPrecoce.checked) {
      sinais.push("Fim da inspiração com fluxo inspiratório ainda positivo (não zera).");

      addAssincronia(
        "Ciclagem precoce",
        "Inspiração termina com fluxo inspiratório ainda positivo.",
        "Prolongar a inspiração: aumentar Ti ou reduzir a sensibilidade de ciclagem (ex.: em PSV, diminuir o % de ciclagem), conforme modo/protocolo."
      );

      hipoteses.push("Término inspiratório antes da demanda do paciente (critério/tempo inspiratório curto).");

      achados.push(
        `Ciclagem precoce (fluxo) → inspiração termina com fluxo ainda positivo. ` +
        notaContexto("Assincronia por término inspiratório antes da demanda do paciente.")
      );
    }

    if (ciclagemTardia.checked) {
      sinais.push("Inspiração mantida apesar de fluxo inspiratório ~zero.");

      addAssincronia(
        "Ciclagem tardia",
        "Inspiração persiste mesmo com fluxo inspiratório ~zero.",
        "Encurtar a inspiração: reduzir Ti ou aumentar a sensibilidade de ciclagem (ex.: em PSV, aumentar o % de ciclagem), conforme modo/protocolo."
      );

      hipoteses.push("Inspiração prolongada além do desejado; pode induzir esforço expiratório ativo (critério/tempo inspiratório longo).");

      achados.push(
        `Ciclagem tardia (fluxo) → inspiração prolongada após fluxo ~zero. ` +
        notaContexto("Assincronia por permanência inspiratória além do desejado.")
      );
    }

    if (letraM.checked) {
      sinais.push("Entalhe no platô inspiratório da pressão formando “M”.");

      addAssincronia(
        "Assincronia por interferência de esforço durante a inspiração (Letra M)",
        "Entalhe no platô de pressão formando M.",
        "Rever sincronização e conforto: checar trigger, rise/pressurização e critérios de término/ciclagem; correlacionar com drive/sedação e metas clínicas."
      );

      hipoteses.push("Interferência de esforço/demanda durante a fase inspiratória; em mandatórios repetidos pode representar o “segundo esforço” do disparo reverso.");

      const extra = (tipoCiclo === "mandatorio")
        ? "Em ciclos mandatórios, o entalhe pode refletir esforço do paciente dentro da inspiração (inclui padrão de disparo reverso quando acoplado)."
        : "Sugere interferência de esforço durante a fase inspiratória; correlacionar com contexto e repetitividade.";

      achados.push(Letra M (pressão) → entalhe no platô formando “M”. ${notaContexto(extra)});
    }

    if (concavidade.checked) {
      const fase = document.getElementById("concavidade_fase").value;
      const local = document.getElementById("concavidade_local").value;
      sinais.push(Concavidade (“afundamento”) no fluxo na ${fase} (${local}).);

      addAssincronia(
        "Padrão compatível com demanda/esforço modulando o fluxo (contextual)",
        Concavidade na ${fase} (${local}).,
        "Correlacionar com modo e contexto; revisar assistência/sincronia (trigger, rise/fluxo, ciclagem) e conforto do paciente, conforme objetivos clínicos."
      );

      hipoteses.push("Modulação do fluxo por esforço/demanda do paciente na fase indicada (interpretar com pressão/volume e modo ventilatório).");

      achados.push(
        `Concavidade no fluxo → concavidade na ${fase} (${local}). ` +
        notaContexto("Sugere modulação do fluxo por demanda/esforço; não define isoladamente o mecanismo.")
      );
    }

    if (convexidade.checked) {
      const fase = document.getElementById("convexidade_fase").value;
      const local = document.getElementById("convexidade_local").value;
      sinais.push(Convexidade (abaulamento para fora) no fluxo na ${fase} (${local}).);

      addAssincronia(
        "Padrão mais imposto/possível sobreassistência (contextual)",
        Convexidade na ${fase} (${local}).,
        "Reavaliar nível de assistência/suporte e sincronização; ajustar para evitar sobreassistência conforme metas ventilatórias e resposta clínica."
      );

      hipoteses.push("Padrão mais imposto/assistido; pode sugerir sobreassistência dependendo do contexto e modo.");

      achados.push(
        `Convexidade no fluxo → convexidade na ${fase} (${local}). ` +
        notaContexto("Sugere padrão mais imposto/assistido; interpretar com modo e contexto.")
      );
    }

    if (fluxoTremidoExp.checked) {
      sinais.push("Serrilhado/oscilações repetidas no ramo expiratório do fluxo.");

      addAssincronia(
        "Interferência por secreção/condensado (não é assincronia clássica)",
        "Fluxo expiratório serrilhado/“tremido”.",
        "Checar secreções/condensado e patência do circuito/tubo; considerar aspiração/higiene brônquica conforme avaliação clínica e rotina."
      );

      hipoteses.push("Secreções, condensado ou interferência no sistema (tubo/circuito).");

      achados.push(
        `Fluxo expiratório “tremido” → serrilhado/oscilações no ramo expiratório. ` +
        notaContexto("Sugere secreções/condensado/interferência no sistema.")
      );
    }

    if (raizQuadrada.checked) {
      sinais.push("Padrão compatível com limitação ao fluxo (aspecto em “raiz quadrada”).");

      addAssincronia(
        "Aumento de resistência de via aérea (mecânica; não assincronia isolada)",
        "Padrão em raiz quadrada/limitação ao fluxo.",
        "Avaliar broncoespasmo/obstrução e tratar conforme prescrição; otimizar tempo expiratório e revisar obstrução por secreção/tubo, conforme clínica."
      );

      hipoteses.push("Aumento de resistência (compatível com broncoespasmo/obstrução); correlacionar com clínica e pressões.");

      achados.push(
        `“Sinal de raiz quadrada” → padrão de limitação ao fluxo / aumento de resistência. ` +
        notaContexto("Compatível com aumento de resistência; correlacionar com clínica.")
      );
    }

    if (spikeSaida.checked) {
      sinais.push("Espícula/pico curto de pressão no fim da inspiração (saída/ciclagem).");

      addAssincronia(
        "Instabilidade na transição inspiração→expiração (contextual)",
        "Spike de saída na pressão (fim da inspiração).",
        "Rever parâmetros de término/ciclagem e suavidade de transição; correlacionar com esforço no fim da inspiração e com o modo ventilatório."
      );

      hipoteses.push("Transição abrupta/instabilidade na ciclagem; correlacionar com modo e interação paciente–ventilador.");

      achados.push(
        `Spike (saída, pressão) → espícula no fim da inspiração. ` +
        notaContexto("Sugere instabilidade na transição; interpretar com modo e ajustes de término.")
      );
    }

    if (overshoot.checked) {
      const tipo = valRadio("ov_tipo") || "entrada";
      if (tipo === "entrada") {
        sinais.push("Overshoot na entrada: excede o alvo no início da inspiração e retorna.");

        addAssincronia(
          "Overshoot de entrada",
          "Excesso de pressão no início (entrada/rise).",
          "Reduzir agressividade da pressurização (ex.: aumentar rise time) se clinicamente indicado; checar oscilação do sistema/circuito."
        );

        hipoteses.push("Subida agressiva (rise curto) ou oscilação do sistema (complacência/resistência/circuito).");

        achados.push(
          `Overshoot (entrada, pressão) → excede o alvo no início e retorna. ` +
          notaContexto("Frequentemente relacionado a subida agressiva ou oscilação do sistema.")
        );
      } else {
        sinais.push("Overshoot na saída: excede o alvo no fim da inspiração/na ciclagem e retorna.");

        addAssincronia(
          "Overshoot de saída",
          "Excesso de pressão no fim/ciclagem (saída).",
          "Rever término/ciclagem e interação no fim da inspiração; ajustar parâmetros para reduzir instabilidade na troca de fase, conforme modo."
        );

        hipoteses.push("Instabilidade na troca de fase (fim/ciclagem), término abrupto ou interação com esforço no fim da inspiração.");

        achados.push(
          `Overshoot (saída, pressão) → excede o alvo no fim/ciclagem e retorna. ` +
          notaContexto("Pode refletir instabilidade na troca de fase ou interação com esforço no fim da inspiração.")
        );
      }
    }

    if (degrauRecorrente.checked) {
      sinais.push("Degraus repetidos no fluxo após aspiração (padrão recorrente).");

      addAssincronia(
        "Obstrução parcial persistente (contextual)",
        "Degrau recorrente após aspiração.",
        "Reavaliar patência do tubo/circuito e persistência de secreção; considerar repetir higiene brônquica/aspiração e investigar causa de obstrução persistente conforme avaliação clínica."
      );

      hipoteses.push("Fator persistente: secreção/obstrução parcial/patência do tubo; correlacionar com pressões e clínica.");

      achados.push(
        `Degrau recorrente pós-aspiração (fluxo) → degraus repetidos após aspiração. ` +
        notaContexto("Sugere fator persistente; correlacionar com clínica.")
      );
    }

    // --- SAÍDAS ---
    if (achados.length === 0) {
      resultado.innerHTML = Contexto do ciclo: ${labelTipoCiclo(tipoCiclo)}. Nenhum achado selecionado.;
      detalhes.innerHTML = "";
      resumoBox.style.display = "none";
      return;
    }

    resultado.innerHTML = Contexto do ciclo: ${labelTipoCiclo(tipoCiclo)}. Interpretação sugerida:;
    detalhes.innerHTML = "<ul><li>" + achados.join("</li><li>") + "</li></ul>";

    const sinaisU = unique(sinais);
    const assincriasU = mapToArray(assincroniaMap);
    const correcoesU = mapToArray(correcaoMap);
    const hipU = unique(hipoteses);

    resumoBox.style.display = "block";
    listaSinais.innerHTML = "<li>" + sinaisU.join("</li><li>") + "</li>";
    listaAssincronias.innerHTML = "<li>" + assincriasU.join("</li><li>") + "</li>";
    listaCorrecoes.innerHTML = "<li>" + correcoesU.join("</li><li>") + "</li>";
    listaHipoteses.innerHTML = "<li>" + hipU.join("</li><li>") + "</li>";
    notaCtx.textContent = notaResumo();
  }
</script>

<footer>
  <p>
    <strong>Aviso educacional:</strong><br>
    Este material tem finalidade exclusivamente educacional e de apoio ao raciocínio clínico.
    Não substitui a avaliação individual do paciente, o julgamento do profissional de saúde
    ou protocolos institucionais. As interpretações e correções devem sempre ser correlacionadas com o
    contexto clínico e ventilatório.
  </p>

  <p>
    <strong>Autoria:</strong> Leticia Moreira.<br>
    © 2026 Leticia Moreira – Todos os direitos reservados.<br>
    Uso permitido para fins educacionais e não comerciais, com citação da autora.
    É vedada a reprodução, distribuição ou modificação para fins comerciais sem autorização expressa.
  </p>
</footer>

</body>
</html>
